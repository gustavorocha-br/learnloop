{% extends 'base.html' %}

{% block title %}LearnLoop One{% endblock %}

{% block styled %}
<style>
  #conteudo {
    display: flex;
    flex-direction: column;
    gap: 1em;
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <h3>{{artigo.titulo}}</h3>
  <small>Criado por: {{autor.username}}</small>

  <section onclick="window.location.href='https://www.instagram.com/realengof7'">
    <img src="{{url_for('static', filename='img/ads.png')}}">
  </section>
  <div id="conteudo">
    <p>{{artigo.texto | safe}}</p>
  </div>

  <div class="btns">
    <button onclick="window.location.href = '/add-like/{{artigo.id}}'">
      <span class="material-symbols-outlined">thumb_up</span> ({{artigo.likes}})
    </button>

    <button style='margin-top: 1em;' onclick="tiraDuvida()">
      Tirar Dúvida
    </button>
    {% if session['user'] == artigo.autor %}
    <button onclick="deleteArtigo()" style="margin-top: 1em;">Deletar Artigo</button>
    {% endif %}
    <button style="margin-top: 1em;" onclick="copiarToken('https://learnloop.site/artigo/{{artigo.id}}')">Copiar Link do artigo</button>
  </div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@5/dark.css" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>

<script>
function tiraDuvida() {
  Swal.fire({
    title: 'Tirar Dúvida do artigo',
    html: '<input type="text" id="duvida" placeholder="Digite sua dúvida do artigo">',
    focusConfirm: false,
    preConfirm: () => {
      const duvida = document.getElementById('duvida').value;
      return axios.post('/api/tirar-duvida-artigo', {
        duvida: duvida,
        conteudo_artigo: `{{artigo.texto}}`
      })
      .then(response => {
        Swal.fire({
          title: 'Resposta',
          text: response.data.resposta,
          icon: 'success'
        });
      })
      .catch(error => {
        Swal.fire({
          title: 'Erro',
          text: 'Ocorreu um erro ao processar sua solicitação.',
          icon: 'error'
        });
      });
    }
  });
}

function deleteArtigo() {
  alert('ok')
  var senha = prompt("Digite a senha para deletar o artigo:");
  if (senha === false) {
    return;
  } else {
    axios.get("/delete-artigo/{{artigo.id}}?senha="+senha).then((r) => {
      if (r.data.msg === "success") {
        window.location.href='/'
      }
    });
  }
}

function copiarToken(link) {
  let tempInput = document.createElement("input");
  tempInput.value = link;
  document.body.appendChild(tempInput);
  tempInput.select();
  tempInput.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(tempInput);
  alert("O link do artigo foi copiado");
}
</script>
{% endblock %}
