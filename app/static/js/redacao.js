function redacao() {
  var title = document.getElementById("titulo");
  var conteudo = document.getElementById("conteudo");

  Swal.fire({
    title: "Corrigindo sua reda√ß√£o...",
    text: "Aguarde, em instantes voc√™ ser√° redirecionado para uma p√°gina com a corre√ß√£o detalhada.",
    icon: "info"
  })
  
  axios.post("/learn-ai/redacao", {
    title: title.value,
    content: conteudo.value,
    nivel: document.getElementById("nivel").value,
    tema: document.getElementById("tema").value
  }).then((r) => {
    if (r.data.msg === "success") {
      window.location.href = '/correcao/'+r.data.response
    } else {
      document.getElementById("resposta").innerHTML = r.data.details;
    }
  }).catch((error) => {
    Swal.fire({
      title: "Houve um erro ao corrigir a sua redac√£o.",
      text: `${r.data.response}`,
      icon: "error"
    })
    console.error("Erro:", error);
  });
}

Swal.fire({
  title: "Conhe√ßa o Corretor de Reda√ß√£o",
  text: "Envie sua reda√ß√£o para receber orienta√ß√µes do Learn.Ai, a intelig√™ncia artificial do LearnLoop. Voc√™ pode digitar ou enviar uma foto da reda√ß√£o manuscrita. Se quiser, pode salvar a reda√ß√£o na sua conta, mas isso √© opcional. N√£o se preocupe, sua reda√ß√£o s√≥ ser√° armazenada se voc√™ optar por isso. Estamos aqui para ajudar voc√™ a se preparar para o ENEM. üí°",
  icon: 'info'
});

function carregarFoto() {
  Swal.fire({
    title: "Carregar Foto",
    description: "Fa√ßa o upload da foto de seu caderno aqui",
    html: `
      <input type="file" id="foto" >
    `,
    preConfirm: () => {
      const formData = new FormData();
      var foto = document.getElementById("foto");
      formData.append("foto", foto.files[0]);

      return axios.post("/api/carregar-redacao", formData, {
        headers: {
          "Content-Type": `multipart/form-data; boundary=${formData._boundary}`
        }
      }).then((f) => {
        if (f.data.msg === "success") {
          document.getElementById("conteudo").value += f.data.redacao;
        }
      }).catch((error) => {
        Swal.fire({
          title: "Erro ao carregar sua foto",
          text: "Verifique se o arquivo est√° nos formatos: '.png, .jpeg, jpg' e tente novamente.",
          icon: "error"
        })
      });
    }
  });
}

function salvarRedacao() {
  var titulo = document.getElementById("titulo").value;
  var texto = document.getElementById("conteudo").value;

  Swal.fire({
    title: "Salvando sua reda√ß√£o...",
    text: "Por favor, aguarde.",
    icon: "info",
    allowOutsideClick: false,
    showConfirmButton: false,
    didOpen: () => {
      Swal.showLoading();

      axios.post("/api/save-redacao", {
        titulo: titulo,
        texto: texto
      }).then((response) => {
        Swal.close();
        if (response.data.msg === "success") {
          Swal.fire({
            title: "Sucesso!",
            text: "Reda√ß√£o salva com sucesso.",
            icon: "success",
            confirmButtonText: "OK"
          });
        } else {
          Swal.fire({
            title: "Erro",
            text: "Erro ao salvar a reda√ß√£o.",
            icon: "error",
            confirmButtonText: "Tentar novamente"
          });
        }
      }).catch((error) => {
        Swal.close();
        Swal.fire({
          title: "Erro",
          text: "Ocorreu um erro ao tentar salvar sua reda√ß√£o.",
          icon: "error",
          confirmButtonText: "Tentar novamente"
        });
        console.error("Erro:", error);
      });
    }
  });
}

function redacaoGuiada() {
  var tema = document.getElementById("tema").value;
  var texto = document.getElementById("conteudo").value;

  // Exibir alerta de carregamento
  Swal.fire({
    title: 'Carregando...',
    text: 'Aguarde enquanto processamos sua reda√ß√£o.',
    allowOutsideClick: false,
    didOpen: () => {
      Swal.showLoading();
    }
  });

  axios.post("/api/redacao-guiada", {
    tema: tema,
    texto: texto
  }).then((response) => {
    var data = response.data;
    // Fechar o alerta de carregamento
    Swal.close();

    if (data.msg === "success") {
      Swal.fire({
        title: "Reda√ß√£o Guiada",
        text: data.guia
      });
    }
  }).catch((error) => {
    // Fechar o alerta de carregamento em caso de erro
    Swal.close();

    Swal.fire({
      title: 'Erro!',
      text: 'Ocorreu um erro ao processar sua solicita√ß√£o.',
      icon: 'error'
    });
  });
}
